<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Advanced Tic Tac Toe</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      color: white;
      text-align: center;
      background: linear-gradient(270deg, #00ff00, #00ffff, #ff00ff);
      background-size: 600% 600%;
      animation: rgbBackground 12s ease infinite;
    }
    @keyframes rgbBackground {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }
    .page { display: none; padding: 20px; }
    .active { display: block; }

    /* Mode Page */
    .modes-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      margin-top: 30px;
    }
    .mode-card {
      width: 280px;
      padding: 20px;
      background: rgba(0,0,0,0.6);
      border-radius: 15px;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }
    .mode-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 20px rgba(0,255,255,0.8);
      background: rgba(0,0,0,0.8);
    }

    /* Game Board */
    .board {
      display: grid;
      grid-template-columns: repeat(3,100px);
      gap: 5px;
      justify-content: center;
      margin: 20px auto;
    }
    .cell {
      width: 100px;
      height: 100px;
      background: rgba(0,0,0,0.7);
      font-size: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      border-radius: 10px;
      box-shadow: 0 0 10px #fff inset;
      transition: 0.3s;
    }
    .cell:hover { background: rgba(255,255,255,0.1); }
    .x { color: red; text-shadow: 0 0 10px red, 0 0 20px red; }
    .o { color: cyan; text-shadow: 0 0 10px cyan, 0 0 20px cyan; }

    /* Leaderboard */
    .leaderboard-container {
      max-height: 300px;
      overflow-y: auto;
      margin: 20px auto;
      width: 80%;
      border: 2px solid white;
      border-radius: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
    }
    th, td {
      border: 1px solid white;
      padding: 8px;
    }
    .highlight { background: rgba(255,255,0,0.5); }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #222;
      color: white;
      box-shadow: 0 0 10px white;
      transition: 0.3s;
    }
    button:hover { background: #444; }
  </style>
</head>
<body>

<!-- Modes Page -->
<div class="page active" id="modesPage">
  <h1 id="welcomeText">Welcome, Guest</h1>
  <div class="modes-container">
    <div class="mode-card" onclick="showRegister()">üìù Register Yourself</div>
    <div class="mode-card" onclick="startSingleplayer()">ü§ñ Singleplayer</div>
    <div class="mode-card" onclick="startNormalMode()">üéÆ Normal Mode</div>
    <div class="mode-card" onclick="showTournament()">üèÜ Tournament</div>
  </div>
</div>

<!-- Register Page -->
<div class="page" id="registerPage">
  <h1>Register Yourself</h1>
  <input type="text" id="playerName" placeholder="Enter your name">
  <button onclick="registerName()">OK</button>
</div>

<!-- Game Page -->
<div class="page" id="gamePage">
  <h1 id="gameModeTitle">Game</h1>
  <div class="board" id="board"></div>
  <button onclick="backToModes()">Exit Match</button>
</div>

<!-- Tournament Page -->
<div class="page" id="tournamentPage">
  <h1>üèÜ Tournament Leaderboard üèÜ</h1>
  <h2 id="yourRank"></h2>
  <div class="leaderboard-container">
    <table id="leaderboard">
      <tr><th>Rank</th><th>Name</th><th>Score</th></tr>
    </table>
  </div>
  <button onclick="backToModes()">Back to Modes</button>
</div>

<script>
  let currentPage = "modesPage";
  let playerName = "Guest";
  let mode = null;
  let board = Array(9).fill(null);
  let currentPlayer = "X";
  let gameActive = false;

  // Fake 20 players
  let players = [
    {name: "Alice", score: 5}, {name: "Bob", score: 8}, {name: "Charlie", score: 3},
    {name: "David", score: 10}, {name: "Eva", score: 2}, {name: "Frank", score: 6},
    {name: "Grace", score: 4}, {name: "Hannah", score: 9}, {name: "Ian", score: 1},
    {name: "Jack", score: 7}, {name: "Kelly", score: 3}, {name: "Leo", score: 5},
    {name: "Mona", score: 2}, {name: "Nina", score: 6}, {name: "Oscar", score: 4},
    {name: "Paul", score: 8}, {name: "Quinn", score: 7}, {name: "Rose", score: 9},
    {name: "Sam", score: 2}, {name: "Tom", score: 5}
  ];

  function showPage(id) {
    document.getElementById(currentPage).classList.remove("active");
    document.getElementById(id).classList.add("active");
    currentPage = id;
  }

  function showRegister() { showPage("registerPage"); }

  function registerName() {
    const nameInput = document.getElementById("playerName").value.trim();
    if (nameInput) {
      playerName = nameInput;
      alert("You are registered!");
    }
    document.getElementById("welcomeText").innerText = "Welcome, " + playerName;
    showPage("modesPage");
  }

  function startSingleplayer() {
    mode = "single";
    resetBoard();
    showPage("gamePage");
    document.getElementById("gameModeTitle").innerText = "Singleplayer vs AI";
    aiMove(); // AI goes first
  }

  function startNormalMode() {
    mode = "normal";
    resetBoard();
    showPage("gamePage");
    document.getElementById("gameModeTitle").innerText = "Normal Mode";
  }

  function backToModes() { showPage("modesPage"); }

  function resetBoard() {
    board = Array(9).fill(null);
    currentPlayer = "X";
    gameActive = true;
    const boardDiv = document.getElementById("board");
    boardDiv.innerHTML = "";
    board.forEach((_,i) => {
      const cell = document.createElement("div");
      cell.classList.add("cell");
      cell.onclick = () => handleMove(i);
      boardDiv.appendChild(cell);
    });
  }

  function handleMove(index) {
    if (!gameActive || board[index] !== null) return;
    if (mode === "single" && currentPlayer !== "O") return;

    board[index] = currentPlayer;
    updateBoard();

    if (checkWinner(currentPlayer)) {
      if (mode === "single") {
        return endGame(currentPlayer === "O" ? "You Won! üíØ" : "You Defeated! ‚ò†Ô∏è");
      } else {
        return endGame(currentPlayer + " Won! üéâ");
      }
    }
    if (board.every(c => c)) return endGame("Match Tied! üôÉ");

    if (mode === "single") {
      currentPlayer = "X";
      setTimeout(aiMove, 500);
    } else {
      currentPlayer = currentPlayer === "X" ? "O" : "X";
    }
  }

  function updateBoard() {
    const cells = document.querySelectorAll(".cell");
    board.forEach((val,i) => {
      if (val) {
        cells[i].innerText = val;
        cells[i].className = "cell " + val.toLowerCase();
      }
    });
  }

  function checkWinner(player) {
    const wins = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];
    return wins.some(pattern => pattern.every(i => board[i] === player));
  }

  function aiMove() {
    if (!gameActive) return;
    const emptyCells = board.map((v,i)=>v?null:i).filter(v=>v!==null);
    if (emptyCells.length===0) return;
    const move = emptyCells[Math.floor(Math.random()*emptyCells.length)];
    board[move] = "X";
    updateBoard();
    if (checkWinner("X")) return endGame("You Defeated! ‚ò†Ô∏è");
    if (board.every(c => c)) return endGame("Match Tied! üôÉ");
    currentPlayer = "O";
  }

  function endGame(message) {
    gameActive = false;
    setTimeout(()=>{
      if (confirm(message + "\nPlay again?")) {
        if (mode==="single") startSingleplayer();
        else startNormalMode();
      } else {
        backToModes();
      }
    },100);
  }

  function showTournament() {
    generateLeaderboard();
    showPage("tournamentPage");
  }

  function generateLeaderboard() {
    if (!players.some(p => p.name === playerName)) {
      players.push({name: playerName, score: 0});
    }

    let sorted = [...players].sort((a,b) => b.score - a.score);
    const table = document.getElementById("leaderboard");
    table.innerHTML = '<tr><th>Rank</th><th>Name</th><th>Score</th></tr>';

    let yourRank = null;
    sorted.forEach((p,i)=>{
      let row = document.createElement("tr");
      if (p.name === playerName) {
        row.classList.add("highlight");
        yourRank = i+1;
      }
      row.innerHTML = `<td>${i+1}</td><td>${p.name}</td><td>${p.score}</td>`;
      table.appendChild(row);
    });

    document.getElementById("yourRank").innerText =
      yourRank ? `Your Rank: #${yourRank} out of ${sorted.length}` : "Your Rank: Not Found";
  }
</script>
</body>
</html>